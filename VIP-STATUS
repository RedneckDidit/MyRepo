#---------------------------------------------------------------------
# FrontEnd Configuration
#---------------------------------------------------------------------
frontend ft_web
  bind *:8080 name web
  # log the session cookie if passed
  default_backend platform
#---------------------------------------------------------------------
# BackEnd Platform Configuration
#---------------------------------------------------------------------
backend platform
  balance roundrobin
  # sticky sessions
  cookie SERVER insert indirect nocache
  http-request set-header X-Forwarded-Port %[dst_port]
  http-request add-header X-Forwarded-Proto https if { ssl_fc }
  # health check
  option httpchk GET /Thingworx/health
  # configure platform instances
  server platform1 10.0.10.10:8080 check inter 1000 fastinter 1000" cookie twx1
  server platform2 10.0.10.11:8080 check inter 1000 fastinter 1000" cookie twx2
